var PERLIN=Object.create(null);PERLIN.Generator=function(a){this._table=a||PERLIN.Generator.makeTable(255),this.octaves=10,this.frequency=.05,this.persistence=.5},PERLIN.Generator.random=function(){return Math.random()},PERLIN.Generator.makeTable=function(a){var b=[];for(var c=0;c<a;++c)b[c]=PERLIN.Generator.random();return b},PERLIN.Generator.cosineInterpolate=function(a,b,c){var d=(1-Math.cos(c*Math.PI))*.5;return(1-d)*a+d*b},PERLIN.Generator.prototype={_randify:function(a){return this._table[Math.floor(a%this._table.length)]},_noise:function(a){var b=0,c=a.length;for(var d=0;d<c;++d)b=this._randify(Math.floor(b*85e3)+a[d]);return b},_smooth:function(a,b){if(b<0)return this._noise(a);var c=a[b],d=Math.floor(c),e=c-d;a[b]=d;var f=this._smooth(a,b-1);a[b]=d+1;var g=this._smooth(a,b-1);return a[b]=c,PERLIN.Generator.cosineInterpolate(f,g,e)},_perlin:function(a){var b=0,c=1,d=this.octaves,e=this.frequency,f=this.persistence,g=a.slice(),h=g.length;for(var i=0;i<d;++i){var j=i*4096;for(var k=0;k<h;++k)g[k]=a[k]*e+j;b+=this._smooth(g,h-1)*c,c*=f,e*=2}var l=(1-f)/(1-c);return b*l},_generate:function(a,b,c,d){if(d<0)return c(a,this._perlin(a));for(var e=a[d]+b[d];a[d]<e;++a[d])this._generate(a,b,c,d-1);return a[d]-=b[d],null},generate:function(a,b,c){this._generate(a,b,c,a.length-1)}}